<?xml version="1.0" encoding="UTF-8" ?>

<!-- ld31 classes -->

<objects>
	
	<const type="color" name="TorchLight">ffff9900</const>

	<class name="TorchFlame" extends="MovieClip">
		<animFramesPerSecond>12</animFramesPerSecond>
		<passthrough>
			<keyframe>
				<texture>Texture'torch_flame'</texture>
				<textureWindow>0,0,0.25,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'torch_flame'</texture>
				<textureWindow>0.25,0,0.5,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'torch_flame'</texture>
				<textureWindow>0.5,0,0.75,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'torch_flame'</texture>
				<textureWindow>0.75,0,1,1</textureWindow>
			</keyframe>
		</passthrough>
	</class>

	<class name="TorchBase" extends="MovieClip">
		<animFramesPerSecond>12</animFramesPerSecond>
		<passthrough>
			<keyframe>
				<texture>Texture'torch_base'</texture>
				<textureWindow>0,0,0.25,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'torch_base'</texture>
				<textureWindow>0.25,0,0.5,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'torch_base'</texture>
				<textureWindow>0.5,0,0.75,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'torch_base'</texture>
				<textureWindow>0.75,0,1,1</textureWindow>
			</keyframe>
		</passthrough>
	</class>
	
	<class name="TorchGraphic" extends="DisplayObjectContainer">
		<children>
			<object class="TorchBase" name="$^_base"></object>
			<object class="TorchFlame" name="$^_flame"></object>
		</children>
	</class>

	<class name="Cracks" extends="MovieClip">
		<isPlaying>false</isPlaying>
		<isLooping>false</isLooping>
		<color>ff808080</color>
		<passthrough>
			<keyframe>
				<texture>Texture'cracks'</texture>
				<textureWindow>0,0,0.125,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'cracks'</texture>
				<textureWindow>0.125,0,0.25,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'cracks'</texture>
				<textureWindow>0.25,0,0.375,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'cracks'</texture>
				<textureWindow>0.375,0,0.5,1</textureWindow>
			</keyframe>
			<keyframe>
				<texture>Texture'cracks'</texture>
				<textureWindow>0.5,0,0.625,1</textureWindow>
			</keyframe>
		</passthrough>
	</class>
	
	<class name="ItemBreakParticles" extends="ParticleEmitter">
		<particleTexture>Texture'debris'</particleTexture>
		<cycleDuration>1.5</cycleDuration>
		<destroyWhenAllDead>true</destroyWhenAllDead>
		<rectSpawnArea>(-4,-6,4,6)</rectSpawnArea>
		<baseScale>8</baseScale>
		<particleForce>0,-30.0</particleForce>
		<spawnScaleRange>((0.25),(1.0))</spawnScaleRange>
		<spawnSpeedRange>(0,1)</spawnSpeedRange>
		<velocityDamping>0.1</velocityDamping>
		<startingParticles>40</startingParticles>
		<creationSpawnBurst>true</creationSpawnBurst>
		<creationPauseAfterBurst>true</creationPauseAfterBurst>
		<vecKeyframesScale>[
			{0, (0)},
			{0.15, (1)},
			{1, (0)},
			]</vecKeyframesScale>
		<perParticleColorRange>(Gray,White)</perParticleColorRange>
	</class>
	
	<class name="LightSourceConfigured" extends="LightSource">
		<lightMask>LightMask'$^_host_light_mask'</lightMask>
		<gradientHost>Sprite'$^_host_light_gradient'</gradientHost>
		<overlay>Sprite'$^_overlay'</overlay>
		
		<overlayRadiusScalar>0.9</overlayRadiusScalar>
		
		<children>
			<object class="DisplayObjectContainer" name="$^_host">
				<maskStencilReadMode>MaskExclusive</maskStencilReadMode>
				<mask>
					<object class="LightMask" name="$^_light_mask">
						<owner>LightSourceConfigured'$^^^'</owner>
						<shaderProgram>ShaderProgram'SP_Pos2Only'</shaderProgram>
						<mesh><object class="SimpleMesh" /></mesh>
					</object>
				</mask>
					
				<children>
					<object class="Sprite" name="$^_light_gradient">
						<shaderProgram>ShaderProgram'SP_LightDiffuse'</shaderProgram>
						<blendMode>Add</blendMode>
						<texture>Texture'light_glow'</texture>
					</object>
				</children>
			</object>
			<object class="Sprite" name="$^_overlay">
				<shaderProgram>ShaderProgram'SP_LightDiffuse'</shaderProgram>
				<blendMode>Add</blendMode>
				<texture>Texture'light_glow'</texture>
			</object>
		</children>
	</class>
	
	<class name="LightTorch" extends="LightSourceConfigured">
		<color>TorchLight</color>
		<radius>200</radius>
	</class>
	
	<include url="assets/items.xml" subsume-root="true"></include>

	<class name="HumanDefault" extends="Human">
		<dimensions>15</dimensions>
		<grindDamage>4</grindDamage>
		
		<groundedDrag>32</groundedDrag>
		<airDrag>32</airDrag>
		<airControl>1</airControl>
		<controllerImpulseScale>4000</controllerImpulseScale>
		<jumpImpulseScale>0</jumpImpulseScale>
		
		<lightClass>LightTorch</lightClass>
		<lightColor>TorchLight</lightColor>
		<normalLightRadius>200</normalLightRadius>
		<lightRadius>200</lightRadius>
		<lightWobble>32</lightWobble>
		<lightWobbleLerp>0.1</lightWobbleLerp>
	</class>

	<class name="FloorTileTemplate" extends="ldTileTemplate">
		<atlasSubTexture>0,0</atlasSubTexture>
		<isSolid>false</isSolid>
		<mayReceiveItem>true</mayReceiveItem>
		<doesBlockLight>false</doesBlockLight>
		<pctChanceToSpawn>0</pctChanceToSpawn>
		<itemClassWeights>[
			{ TorchConfigured, 7 },
			{ DoorWood, 5 },
			{ DoorIron, 1 },
			{ BlockGravel, 6 },
			{ BlockBrick, 4 },
			{ BlockStone, 2 },
			]</itemClassWeights>
	</class>

	<class name="TileGridDefault" extends="TileGrid">
		<tileClass>ldTile</tileClass>
		<texture>Texture'tile_atlas'</texture>
		<atlasSubdivisions>2,1</atlasSubdivisions>
		<texturesSubdivisionsPerTile>1</texturesSubdivisionsPerTile>
		<tileSize>16</tileSize>
		
		<templates>
			
			<object class="FloorTileTemplate" name="floor_basic">
				<creationColor>ffeaeaea</creationColor>
			</object>
			<object class="FloorTileTemplate" name="floor_tool_spawn_1">
				<creationColor>ff079000</creationColor>
				<pctChanceToSpawn>5</pctChanceToSpawn>
			</object>
			<object class="FloorTileTemplate" name="floor_tool_spawn_2">
				<creationColor>ff42ff00</creationColor>
				<pctChanceToSpawn>15</pctChanceToSpawn>
			</object>
			<object class="FloorTileTemplate" name="floor_tool_spawn_home">
				<creationColor>ffccff00</creationColor>
				<pctChanceToSpawn>40</pctChanceToSpawn>
				<itemClassWeights>[
					{ DoorWood, 3 },
					{ DoorIron, 1 },
					{ BlockGravel, 5 },
					{ BlockBrick, 3 },
					{ BlockStone, 1 },
					]</itemClassWeights>
			</object>
			<object class="FloorTileTemplate" name="floor_immutable">
				<creationColor>fff17c3d</creationColor>
				<mayReceiveItem>false</mayReceiveItem>
			</object>
			<object class="ldTileTemplate" name="wall_immutable">
				<atlasSubTexture>1,0</atlasSubTexture>
				<creationColor>ff444444</creationColor>
				<mayReceiveItem>false</mayReceiveItem>
			</object>
			<object class="ldTileTemplate" name="wall_really_immutable">
				<atlasSubTexture>1,0</atlasSubTexture>
				<creationColor>ffc65112</creationColor>
				<mayReceiveItem>false</mayReceiveItem>
			</object>
			
		</templates>
	</class>

</objects>

